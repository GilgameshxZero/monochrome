"use strict";{const e=self,t=e,n=e.document,l=n.documentElement,s=l.classList;(self.webpackChunkStylus=self.webpackChunkStylus||[]).push([["popup"],{3220:(e,l,s)=>{l.configure=configure,l.maybeEdit=function(event){if((0!==event.button||!event.ctrlKey&&!event.metaKey)&&1!==event.button&&2!==event.button)return;const e=event.target;(e.matches(".entry, .style-edit-link")||e.closest(".style-name"))&&(this.onmouseup=()=>this.$(".style-edit-link").click(),this.oncontextmenu=e=>e.preventDefault(),event.preventDefault())},l.openEditor=openEditor,l.openManager=async function(event){event.preventDefault();const isSearch=c.tabUrl&&(event.shiftKey||2===event.button||"site"===event.detail);await i.API.openManager(isSearch?{search:c.tabUrl,searchMode:"url"}:{}),t.close()},l.openURLandHide=openURLandHide,l.toggleUrlLink=function({type}){this.parentElement.classList.toggle("url()","mouseenter"===type||"focus"===type)};var a=s(3831),o=s(7501),i=s(4930),r=s(1480),c=s(8825),d=s(4217);const menu=n.getElementById("menu"),menuExclusions=[];function configure(event,entry){this.target?openURLandHide.call(this,event):d.pause(()=>a.configDialog(entry.styleId))}async function openEditor(event,entry){event.preventDefault(),await i.API.openEditor(this.search||{id:entry.styleId}),t.close()}async function openURLandHide(event){event.preventDefault(),await i.API.openURL({url:this.href||this.dataset.href,index:(await r.getActiveTab()).index+1}),t.close()}const GlobalRoutes={"#installed:empty"(){n.getElementById("find-styles-btn").click()},"#menu [data-cmd]"(){if("delete"===this.dataset.cmd){if(menu.classList.toggle("delete"))return;i.API.styles.remove(menu.styleId)}menuHide()},".copy"({target}){navigator.clipboard.writeText(target.textContent),target.classList.add("copied"),setTimeout(()=>{target.classList.remove("copied")},1e3)}},EntryRoutes={async input(event,entry){event.stopPropagation(),await i.API.styles.toggle(entry.styleId,this.checked),c.resortEntries()},".configure":configure,".menu-button"(event,entry){menuExclusions.length||menuInit();const exc=entry.styleMeta.exclusions||[];for(const e of menuExclusions)e.el.title=e.rule,e.el.classList.toggle("enabled",e.input.checked=exc.includes(e.rule));menu.classList.remove("delete"),menu.styleId=entry.styleId,menu.hidden=!1,t.on("keydown",menuOnKey),menu.$("header").textContent=entry.$(".style-name").textContent,a.moveFocus(menu,0)},".style-edit-link":openEditor,".regexp-problem-indicator"(event,entry){const info=o.template.regexpProblemExplanation.cloneNode(!0);n.getElementById(info.id)?.remove(),entry.appendChild(info)},"#regexp-explanation a":openURLandHide,"#regexp-explanation button"(){n.getElementById("regexp-explanation").remove()}};function menuInit(){const e=new URL(c.tabUrl);for(const t of n.querySelectorAll("[data-exclude]")){const input=t.$("input"),rule=e.origin+("domain"===t.dataset.exclude?"/*":e.pathname.replace(/\*/g,"\\*"));menuExclusions.push({el:t,input,rule}),input.onchange=()=>{t.classList.toggle("enabled",input.checked),i.API.styles.toggleOverride(menu.styleId,rule,!1,input.checked)}}}function menuHide(){menu.hidden=!0,t.off("keydown",menuOnKey)}function menuOnKey(e){switch(a.getEventKeyName(e)){case"Tab":case"Shift-Tab":e.preventDefault(),a.moveFocus(menu,e.shiftKey?-1:1);break;case"Escape":e.preventDefault(),menuHide()}}n.on("click",event=>{const{target}=event,entry=target.closest(".entry");for(let map=entry?EntryRoutes:GlobalRoutes;;map=GlobalRoutes){const e=map["."+target.className]||map[target.localName];if(e)return e.call(target,event,entry);for(const selector in map)for(let e=target;e&&e!==entry;e=e.parentElement)if(e.matches(selector))return void map[selector].call(e,event,entry);if(map===GlobalRoutes)break}})},4217:(e,l,s)=>{l.pause=async function(e,...args){setState(!1),await e(...args),setState(!0)};var a=s(7986),o=s(7501),i=s(4930),r=s(6940);o.tBody();const entries=n.getElementsByClassName("entry"),container=n.getElementById("hotkey-info"),{title}=container;let enabled,togglablesShown=!0,togglables=getTogglables();function setState(newState=!enabled){!newState!=!enabled&&(t[newState?"on":"off"]("keydown",onKeyDown,!0),enabled=newState)}function onKeyDown(event){if(event.ctrlKey||event.altKey||event.metaKey||!enabled||/^(text|search)$/.test(n.activeElement?.type))return;let entry,{key,code,shiftKey}=event;if("Escape"===key&&!shiftKey&&container.dataset.active)return event.preventDefault(),void hideInfo();key>="0"&&key<="9"?entry=entries[(Number(key)||10)-1]:code>="Digit0"&&code<="Digit9"?entry=entries[(Number(code.slice(-1))||10)-1]:"`"===key||"*"===key||"Backquote"===code||"NumpadMultiply"===code?invertTogglables():"-"===key||"NumpadSubtract"===code?toggleState(entries,"enabled",!1):"+"===key||"NumpadAdd"===code?toggleState(entries,"disabled",!0):1===key.length&&(shiftKey=!1,key=key.toLocaleLowerCase(),entry=[...entries].find(e=>e.innerText.toLocaleLowerCase().startsWith(key))),entry?.$(shiftKey?".style-edit-link":"input").click()}function getTogglables(){return[...n.querySelector(".entry.enabled")?n.querySelectorAll(".entry.enabled"):entries].map(entry=>entry.id)}function countEnabledTogglables(){let num=0;for(const e of togglables)num+=n.getElementById(e).classList.contains("enabled");return num}function invertTogglables(){togglables=togglables.length?togglables:getTogglables(),togglablesShown=countEnabledTogglables()>togglables.length/2,toggleState(togglables,null,!togglablesShown),togglablesShown=!togglablesShown}function toggleState(list,match,enable){const results=[];let task=Promise.resolve();for(let entry of list)entry="string"==typeof entry?n.getElementById(entry):entry,(!match&&entry.$("input").checked!==enable||entry.classList.contains(match))&&(results.push(entry.id),task=task.then(()=>i.API.styles.toggle(entry.styleId,enable)).then(()=>{entry.classList.toggle("enabled",enable),entry.classList.toggle("disabled",!enable),entry.$("input").checked=enable}));return results.length&&task.then(i.API.refreshAllTabs),results}function hideInfo(){delete container.dataset.active,n.body.style.height="",container.title=title}!function(){function open(){container.title="",container.style="",container.dataset.active=!0,container.firstElementChild||buildElement();const height=3+container.firstElementChild.scrollHeight+container.lastElementChild.scrollHeight;height>n.body.clientHeight&&(n.body.style.height=height+"px")}function buildElement(){const keysToElements=line=>line.split(/(<.*?>)/).map(e=>e.startsWith("<")?a.$create("mark",e.slice(1,-1)):e);var text;[(text=r.t("popupHotkeysInfo"),text.trim().split("\n").map((line,e,array)=>e<array.length-1?a.$create("p",keysToElements(line)):a.$createLink("https://github.com/openstyles/stylus/wiki/Popup",line))),a.$create("button",r.t("confirmOK"))].forEach(child=>{container.appendChild(a.$create("div",child))})}container.onclick=({target})=>{"button"===target.localName?hideInfo():container.dataset.active||open()}}(),setState(!0)},8825:(e,l,a)=>{l.resortEntries=resortEntries;a(9073);var o=a(7986),i=a(3831),r=a(7501),c=a(3619),d=a(4930),p=a(492),u=a(1949),m=a(8970),g=a(8982),h=a(6940),y=a(1480),f=a(3220);a(4217);const styleFinder={};let tabUrl,tabUrlSupported,isBlocked,prevHeight;const installed=n.getElementById("installed"),EXT_NAME=`<${y.MF.name}>`,TPL_STYLE=r.template.style,b=new IntersectionObserver(function(results){for(const{target:e,boundingClientRect:t}of results){const style=e.$entry.styleMeta;e.title=style.sloppy?h.t("styleNotAppliedRegexpProblemTooltip"):style.excludedScheme?h.t(`styleNotAppliedScheme${h.capitalize(style.preferScheme)}`):e.scrollWidth>t.width+1?e.textContent:""}});function onWindowResize(){const e=innerHeight;e>prevHeight&&"loading"!==n.readyState&&n.body.clientHeight>e+1&&(t.off("resize",onWindowResize),n.body.style.maxHeight=e+"px"),prevHeight=e}async function initPopup(frames,ping0,tab,urlSupported){const kPopupWidth="popupWidth";p.subscribe([kPopupWidth,"popupWidthMax"],(key,val)=>{n.body.style[(key===kPopupWidth?"min":"max")+"-width"]=m.MOBILE?"none":h.clamp(val,200,800)+"px"},!0),i.setupLivePrefs();const elFind=n.getElementById("find-styles-btn");elFind.on("click",async()=>{elFind.disabled=!0,styleFinder.on||await a.e("popup_search_js").then(a.bind(a,1136)),styleFinder.inline()}),elFind.on("split-btn",async e=>{styleFinder.on||await a.e("popup_search_js").then(a.bind(a,1136)),styleFinder.inSite(e)}),t.on("keydown",e=>{"Ctrl-F"===i.getEventKeyName(e)&&(e.preventDefault(),elFind.click())}),Object.assign(n.getElementById("popup-manage-button"),{onclick:f.openManager,oncontextmenu:f.openManager}).on("split-btn",f.openManager),n.getElementById("options-btn").onclick=()=>{d.API.openManager({options:!0}),t.close()};for(const e of n.querySelectorAll("link[media=print]"))e.removeAttribute("media");if(tabUrl=frames[0].url,tabUrlSupported=urlSupported,frames.forEach(createWriterElement),n.querySelector('.match .match:not(.dupe),.match:not([data-frame-id="0"]):not(.dupe)')&&n.getElementById("write-style").append(Object.assign(r.template.writeForFrames,{onclick(){this.remove(),n.getElementById("write-style").classList.add("expanded")}})),ping0)return;const isStore=m.FIREFOX?tabUrl.startsWith("https://addons.mozilla.org/"):m.OPERA?tabUrl.startsWith("https://addons.opera.com/"):tabUrl.startsWith("https://chrome.google.com/webstore/")||tabUrl.startsWith("https://chromewebstore.google.com/");if(blockPopup(),m.CHROME&&isStore||!urlSupported)return;for(let e=performance.now()+1e3;performance.now()<e;){if(await d.API.pingTab(tab.id))return void blockPopup(!1);if("complete"===tab.status&&(m.CHROME||"about:blank"!==tab.url))break;await h.sleep0(),tab=await y.getActiveTab()}const info=r.template.unreachableInfo;if(m.CHROME)info.appendChild(o.$create("p",h.t("unreachableFileHint")));else{info.$("label").textContent=h.t("unreachableAMO");const note=[!isStore&&h.t("unreachableCSP"),isStore&&h.t(m.FIREFOX>=59?"unreachableAMOHint":"unreachableMozSiteHintOldFF"),m.FIREFOX>=60&&h.t("unreachableMozSiteHint")].filter(Boolean).join("\n"),renderToken=e=>"<"===e[0]?o.$create("a.copy",{tabIndex:0,title:h.t("copy")},[e.slice(1,-1),o.$create("i.i-copy")]):e,renderLine=line=>o.$create("p",line.split(/(<.*?>)/).map(renderToken)),noteNode=o.$createFragment(note.split("\n").map(renderLine));info.appendChild(noteNode)}tabUrl.length-tabUrl.lastIndexOf(".")<=5&&info.appendChild(o.$create("p",h.t("InaccessibleFileHint"))),n.body.classList.add("unreachable");const elInfo=n.querySelector(".blocked-info");elInfo?elInfo.replaceWith(info):n.body.prepend(info)}function createWriterElement(frame,index){const{frameId,parentFrameId,isDupe}=frame,url=tabUrlSupported||frameId?frame.url.split("#")[0]:"https://www.example.com/abcd",isAbout=url.startsWith("about:"),crumbs=[];if(!url)return;let e;isAbout?(e=n.createElement("span"),e.textContent=url):(e=(url.startsWith(g.ownRoot)?makeExtCrumbs:makeWebCrumbs)(crumbs,url),e.onmouseenter=e.onmouseleave=e.onfocus=e.onblur=f.toggleUrlLink,index||Object.assign(n.getElementById("write-style-for"),{onclick:e.click.bind(e),title:e.title})),crumbs.push(e);const root=n.getElementById("write-style"),parent=root.$(`[data-frame-id="${parentFrameId}"]`)||root,child=o.$create(`.match${isDupe?".dupe":""}${isAbout?".about-blank":""}`,o.$create(".breadcrumbs",crumbs));child.dataset.frameId=frameId,parent.appendChild(child),parent.dataset.children=(Number(parent.dataset.children)||0)+1}function makeExtCrumbs(crumbs,url){const key="regexp",all="^\\w+-extension://",page=url.slice(g.ownRoot.length,url.indexOf(".html"));return crumbs.push(makeCrumb(key,all+".+",EXT_NAME,EXT_NAME,!0)),makeCrumb(key,`${all}[^/]+/${h.stringAsRegExpStr(page)}.*`,EXT_NAME,page+".*")}function makeWebCrumbs(crumbs,url){const e=new URL(url),t=e.hostname,host=t||url,tail=t&&(e.port?":"+e.port:"")+e.pathname+e.search+e.hash;for(let domain,e,t=0;(domain=host.slice(t))&&((e=domain.split("."))[1]||!t);)e=e[2]?e[0]:domain,crumbs.push(makeCrumb("domain",domain,"",e,!0)),t=host.indexOf(".",t+1)+1||host.length;return makeCrumb("url-prefix",url,"",h.clipString(tail)||h.t("writeStyleForURL"))}function makeCrumb(key,val,name,body,isDomain){const e={[key]:val};return name&&(e.name=name),o.$create("a.write-style-link"+(isDomain?"[subdomain]":""),{href:"edit.html?"+new URLSearchParams(e),onclick:f.openEditor,title:`${key}("${val}")`},body)}function sortStyles(entries){const enabledFirst=p.__values["popup.enabledFirst"];return entries.sort(({styleMeta:e},{styleMeta:t})=>Boolean(e.frameUrl)-Boolean(t.frameUrl)||enabledFirst&&Boolean(t.enabled)-Boolean(e.enabled)||(e.customName||e.name).localeCompare(t.customName||t.name))}function showStyles(frames){const entries=new Map;for(let e=0;e<frames.length;e++){if(isBlocked&&!e)continue;const frame=frames[e];for(let t of frame.styles||[]){const n=t.style.id;entries.has(n)||(t=Object.assign(t.style,t),t.frameUrl=e?frame.url:"",entries.set(n,createStyleElement(t)))}}resortEntries([...entries.values()])}function resortEntries(entries){(entries||p.__values["popup.autoResort"])&&installed.append(...sortStyles(entries||[...installed.children]))}function createStyleElement(style,entry){entry?style=Object.assign(entry.styleMeta,style):(entry=TPL_STYLE.cloneNode(!0),Object.assign(entry,{id:"style-"+style.id,styleId:style.id,styleMeta:style,onmousedown:f.maybeEdit}));const{enabled,frameUrl,usercssData:ucd}=style,name=entry.$(".style-name"),cfg=entry.$(".configure"),cfgUrl=ucd?"":style.url,cls=entry.classList;if(cls.toggle("empty",style.empty),cls.toggle("disabled",!enabled),cls.toggle("enabled",enabled),cls.toggle("force-applied",style.included),cls.toggle("not-applied",style.excluded||style.sloppy||style.excludedScheme),cls.toggle("regexp-partial",style.sloppy),cls.toggle("frame",!!frameUrl),entry.$("input").checked=enabled,name.$entry=entry,name.lastChild.textContent=style.customName||style.name,cfg.hidden=ucd?!ucd.vars:!style.url||!`${style.updateUrl}`.includes("?"),!cfg.hidden&&cfg.href!==cfgUrl){const e=r.template[ucd?"config":"configExternal"].cloneNode(!0);cfgUrl?e.href=cfgUrl:e.removeAttribute("href"),cfg.replaceWith(e)}if(frameUrl){const sel="span.frame-url",frameEl=entry.$(sel)||name.insertBefore(o.$create(sel),name.lastChild);frameEl.title=frameUrl,frameEl.onmousedown=f.maybeEdit}return b.observe(name),entry}async function handleUpdate({style,reason}){const entry=n.getElementById("style-"+style.id);if("toggle"!==reason||!entry){if([style]=await d.API.styles.getByUrl(tabUrl,style.id),!style)return;style=Object.assign(style.style,style)}const e=createStyleElement(style,entry);e.isConnected||installed.append(e),resortEntries()}function blockPopup(val=!0){isBlocked=val,s.toggle("blocked",isBlocked)}function updateStateIcon(newDark,newDisabled){const e=n.querySelector("#disableAll-label img");let srcset=e.srcset;null!=newDark&&(srcset=srcset.replace(/\/\D*/g,newDark?"/":"/light/")),null!=newDisabled&&(srcset=srcset.replace(/x?\./g,newDisabled?"x.":".")),e.srcset=srcset}(async()=>{const data=p.clientData.popup;initPopup(...data),showStyles(...data),prevHeight=Math.max(innerHeight,150),m.MOBILE||t.on("resize",onWindowResize)})(),c.onMessage.set(function(msg){if(!tabUrl)return;let ready;switch(msg.method){case"styleAdded":case"styleUpdated":if("editPreview"===msg.reason||"editPreviewEnd"===msg.reason)return;ready=handleUpdate(msg);break;case"styleDeleted":n.getElementById("style-"+msg.style.id)?.remove()}styleFinder.on?.(msg,ready)}),updateStateIcon(u.isDark),u.onDarkChanged.add(val=>updateStateIcon(val,null)),p.subscribe("popup.stylesFirst",(key,stylesFirst)=>{s.toggle("styles-first",stylesFirst),s.toggle("styles-last",!stylesFirst)},!0),p.subscribe("disableAll",(key,val)=>{updateStateIcon(null,val),n.getElementById("disableAll-label").title=h.t("masterSwitch")+":\n"+h.t(val?"disableAllStylesOff":"genericEnabledLabel")},!0),l.styleFinder=styleFinder,a.d(l,{tabUrl:()=>tabUrl,tabUrlSupported:()=>tabUrlSupported})}},e=>{e.O(0,["common-ui","css_global-dark_css-css_global_css-css_spinner_css"],()=>e(e.s=8825));e.O()}])}