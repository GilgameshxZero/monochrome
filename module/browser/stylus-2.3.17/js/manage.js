"use strict";{const e=self,t=e,s=e.document,n=s.documentElement,a=n.classList;(self.webpackChunkStylus=self.webpackChunkStylus||[]).push([["manage"],{1585:(e,t,a)=>{t.objectDiff=function objectDiff(first,second,path=""){const diff=[];for(const key in first){const e=first[key],t=second[key];e!==t&&(void 0!==t?e&&"function"==typeof e.filter&&t&&"function"==typeof t.filter?(e.length!==t.length||e.some((e,s)=>e&&"object"==typeof e?objectDiff(e,t[s],path+key+"["+s+"].").length:e!==t[s]))&&diff.push({path,key,values:[e,t],type:"changed"}):e&&t&&"object"==typeof e&&"object"==typeof t?diff.push(...objectDiff(e,t,path+key+".")):diff.push({path,key,values:[e,t],type:"changed"}):diff.push({path,key,values:[e],type:"removed"}))}for(const key in second)key in first||diff.push({path,key,values:[second[key]],type:"added"});return diff},t.padLeft=function(val,width){return val=`${val}`," ".repeat(Math.max(0,width-val.length))+val},t.styleToDummyEntry=function(style){const name=style.customName||style.name||"",size=style._size;return delete style._size,{styleMeta:style,styleSize:size,styleNameLC:name.toLocaleLowerCase()+"\n"+name}};var new_ui_namespaceObject={};a.r(new_ui_namespaceObject),a.d(new_ui_namespaceObject,{cfg:()=>cfg,hasFavs:()=>hasFavs,ids:()=>ids,prefKeyForId:()=>prefKeyForId,readPrefs:()=>readPrefs,render:()=>new_ui_render,renderClass:()=>renderClass});var dom=a(7986),localization=a(7501),dom_util=a(3831),msg_api=a(4930),prefs=a(492),themer=a(1949),urls=a(8982),util=a(6940),render=a(9168);const cfg={enabled:null,favicons:null,faviconsGray:null,targets:null},ids=Object.keys(cfg),hasFavs=()=>cfg.enabled&&cfg.favicons,prefKeyForId=e=>`manage.newUI.${e}`.replace(/\.enabled$/,""),MEDIA_NAME="newui";let media;function readPrefs(dest=cfg,e){for(const t of ids){const val=dest[t]=prefs.__values[prefKeyForId(t)];e&&e(t,val)}}function renderClass(){const e=!!cfg.enabled;media||dom_util.getCssMediaRuleByName(MEDIA_NAME,e=>!(media=e)),dom.$toggleClasses(n,{newUI:e,oldUI:!e}),e!==(media[0]===themer.MEDIA_ON)&&(media.mediaText=`${e?themer.MEDIA_ON:themer.MEDIA_OFF},${MEDIA_NAME}`)}function new_ui_render(isInit){const current={},changed={};if(readPrefs(current,(e,value)=>{changed[e]=value!==cfg[e]&&("enabled"===e||current.enabled)}),!isInit&&util.isEmptyObj(changed))return;Object.assign(cfg,current),renderClass(),dom.$toggleClasses(installed,{"has-favicons":hasFavs(),"favicons-grayed":cfg.enabled&&cfg.faviconsGray,"has-targets":!cfg.enabled||!!cfg.targets});const iconsEnabled=hasFavs();let iconsMissing=iconsEnabled&&!s.querySelector("#links img");if(iconsMissing)for(const e of s.querySelectorAll("#links a"))e.prepend(dom.$create("img",{src:urls.favicon(e.hostname)}));else iconsEnabled||isInit||dom.$$remove("#links img");if(!isInit){if(changed.enabled||iconsMissing&&!render.favsBusy&&!render.partEntry)return installed.textContent="",void msg_api.API.styles.getCore({sections:!0,size:!0}).then(render.showStyles);changed.targets&&(iconsMissing=render.renderMissingFavs(cfg.targets,iconsMissing,iconsEnabled)),iconsMissing&&util.debounce(render.renderFavs)}}const installed=localization.template.body.$("#installed"),queue=Object.assign([],{styles:new Map});if(self.fitSelectBox=dom.cssFieldSizing?()=>{}:((showOpts=function(evt){if(evt.button||this[1])return;const opts=this._opts,elems=Object.values(opts),e=elems.indexOf(opts[this.value]);this.style.width=this.offsetWidth+"px",e>0&&this.prepend(...elems.slice(0,e)),this.append(...elems.slice(e+1))},hideOpts=function(evt){for(const e of[...this.options])e.value!==this.value&&e.remove();if(this.style.removeProperty("width"),evt&&evt.isTrusted)return this.offsetWidth},initOpts=function(e){const opts=e._opts={};for(const t of e.options)opts[t.value]=t;e.on("keydown",showOpts),e.on("mousedown",showOpts),e.on("blur",hideOpts),e.on("input",hideOpts);const t=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),"value");Object.defineProperty(e,"value",{get:t.get,set:val=>{const opt=opts["string"==typeof val?val:val=`${val}`];opt.isConnected||(e[0]?e[0].replaceWith(opt):e.append(opt)),t.set.call(e,val),hideOpts.call(e,{})}})})=>(e,value,init)=>{init&&initOpts(e),e.value=value})(),!("loading"in HTMLImageElement.prototype)){const proto=HTMLImageElement.prototype,pSrc=Object.getOwnPropertyDescriptor(proto,"src"),e=new IntersectionObserver(entries=>{for(const t of entries)if(t.intersectionRatio){const s=t.target;pSrc.set.call(s,s.dataset.src),e.unobserve(s),delete s.dataset.src}},{rootMargin:"200px"});Object.defineProperty(proto,"src",Object.assign({},pSrc,{set(val){"lazy"===this.loading?(this.dataset.src=val,e.observe(this)):pSrc.set.call(this,val)}}))}t.installed=installed,t.queue=queue,a.d(t,{newUI:()=>new_ui_namespaceObject})},5393:(e,t,n)=>{t.filterAndAppend=function({entry,container},alreadySearched){container||(c.fitNameColumn(void 0,entry.styleMeta),c.fitSizeColumn(void 0,entry));return reapplyFilter(container||[entry],alreadySearched,entry)},t.showFiltersStats=showFiltersStats;var a=n(7986),l=n(3831),o=n(4930),i=n(492),r=n(6940),c=n(9168),d=n(6677),u=n(8939),p=n(1585);const filtersSelector={hide:"",unhide:"",numShown:-1,numTotal:-1},getValue=e=>"checkbox"===e.type?e.checked:e.value.trim(),fltSearch="search",fltMode="searchMode",fltModePref="manage.searchMode";let elSearch,elSearchMode;function initFilters(){elSearch=s.getElementById("search"),elSearchMode=s.getElementById(fltModePref),elSearchMode.on("change",e=>{"url"===elSearchMode.value&&e.stopPropagation()},!0),elSearch.oninput=()=>d.updateSearch(fltSearch,elSearch.value),elSearchMode.oninput=()=>d.updateSearch(fltMode,elSearchMode.value),s.getElementById("search-help").onclick=event=>{event.preventDefault(),l.messageBox.show({className:"help-text center-dialog",title:r.t(fltSearch),contents:a.$create("ul",r.t("searchStylesHelp").split("\n").map(line=>a.$create("li",line.split(/(<.*?>)/).map((e,t,words)=>{if(e.startsWith("<")){const num=words.length;return a.$create("mark"+(t!==num-2||words[num-1]?"":".last"),e.slice(1,-1))}return e})))),buttons:[r.t("confirmOK")]})},s.querySelectorAll('select[id$=".invert"]').forEach(e=>{const slave=s.getElementById(e.id.replace(".invert","")),slaveData=slave.dataset,valueMap=new Map([[!1,slaveData.filter],[!0,slaveData.filterHide]]);e.oninput=()=>{slave.checked||setTimeout(()=>{slave.checked||(slave.checked=!0,slave.dispatchEvent(new Event("change",{bubbles:!0})))})},e.onchange=event=>{const value="true"===e.value,filter=valueMap.get(value);slaveData.filter!==filter&&(slaveData.filter=filter,slaveData.filterHide=valueMap.get(!value),r.debounce(filterOnChange,0,event))},e.onchange({target:e})}),s.querySelectorAll("[data-filter]").forEach(e=>{e.onchange=filterOnChange,e.closest(".hidden")&&(e.checked=!1)}),s.querySelector("#stats a").onclick=event=>{if(event.preventDefault(),filtersSelector.hide){for(const e of s.querySelectorAll("#filters [data-filter]")){let value;"checkbox"===e.type&&e.checked?value=e.checked=!1:e.value&&(value=e.value=""),void 0!==value&&(e.lastValue=value,i.knownKeys.includes(e.id)&&i.set(e.id,!1))}"url"===elSearchMode.value&&(elSearchMode.value=i.__values[fltModePref]),filterOnChange({force:!0}),d.updateSearch({[fltSearch]:"",[fltMode]:""})}},buildFilters()}function filterOnChange({target,force,alreadySearched}){if(!force){const value=getValue(target);if(value===target.lastValue)return;target.lastValue=value}buildFilters(),elSearch&&reapplyFilter(p.installed,alreadySearched).then(u.updateStripes)}function buildFilters(){filtersSelector.hide=buildFilter(!0),filtersSelector.unhide=buildFilter(!1)}function buildFilter(hide){return(hide?"":".entry.hidden")+[...s.querySelectorAll("#header [data-filter]")].map(e=>getValue(e)&&e.dataset[hide?"filterHide":"filter"].split(/,\s*/).map(e=>(hide?".entry:not(.hidden)":"")+e).join(",")).filter(Boolean).join(hide?",":"")}async function reapplyFilter(container=p.installed,alreadySearched,entry){!alreadySearched&&elSearch.value.trim()&&(container[0]||container.firstChild)&&await searchStyles({immediately:!0,container}),!entry||filtersSelector.hide&&entry.matches(filtersSelector.hide)||entry.classList.add("hidden");let toHide=[],toUnhide=[];if(filtersSelector.hide?filterContainer({hide:!1}):toUnhide=container,toUnhide instanceof DocumentFragment)p.installed.appendChild(toUnhide);else{for(entry of toUnhide.children||toUnhide)entry.parentNode||p.installed.appendChild(entry),entry.classList.contains("hidden")&&entry.classList.remove("hidden");if(filtersSelector.hide&&filterContainer({hide:!0}),toHide.length){for(entry of toHide)entry.classList.add("hidden");if(container instanceof DocumentFragment)return p.installed.appendChild(container),void showFiltersStats();1===toHide.length&&toHide[0].parentElement!==p.installed&&p.installed.appendChild(toHide[0]),showFiltersStats()}else showFiltersStats()}function filterContainer({hide}){const selector=filtersSelector[hide?"hide":"unhide"];if(container.filter){if(hide)return;for(const e of container)(e.matches(selector)?toUnhide:toHide).push(e)}else hide?toHide=[...container.$$(selector)]:toUnhide=[...container.$$(selector)]}}function showFiltersStats(){const active=""!==filtersSelector.hide,numTotal=p.installed.childElementCount,numShown=numTotal-p.installed.getElementsByClassName("entry hidden").length;s.getElementById("header").classList.toggle("filtered",active),filtersSelector.numShown===numShown&&filtersSelector.numTotal===numTotal||(filtersSelector.numShown=numShown,filtersSelector.numTotal=numTotal,s.querySelector("#stats span").textContent=r.t("filteredStyles",[numShown,numTotal]),s.body.classList.toggle("all-styles-hidden-by-filters",!numShown&&numTotal&&filtersSelector.hide))}async function searchStyles({immediately,container}={}){const query=elSearch.value.trim(),mode=elSearchMode.value;if(query===elSearch.lastValue&&mode===elSearchMode.lastValue&&!immediately&&!container)return;if(!immediately)return void r.debounce(searchStyles,150,{immediately:!0});elSearch.lastValue=query,elSearchMode.lastValue=mode;const all=p.installed.children,entries=container&&container.children||container||all,idsToSearch=entries!==all&&[...entries].map(e=>e.styleId),ids=entries[0]?await o.API.styles.searchDb({query,mode,ids:idsToSearch}):[];let needsRefilter=!1;for(const entry of entries){const isMatching=ids.includes(entry.styleId);entry.classList.contains("not-matching")!==!isMatching&&(entry.classList.toggle("not-matching",!isMatching),needsRefilter=!0)}return needsRefilter&&!container&&filterOnChange({force:!0,alreadySearched:!0}),container}d.watch({search:[fltSearch,fltMode]},([search,mode])=>{const firstRun=!elSearch;firstRun&&initFilters(),elSearch.value=search||"",elSearchMode.value=mode||i.__values[fltModePref],firstRun||searchStyles()}),t.filtersSelector=filtersSelector,n.d(t,{})},6598:(e,t,n)=>{n(9073);var a=n(7986),l=n(3831),o=n(7501),i=n(3619),r=n(492),c=n(4188),d=n(6940),u=n(9168),p=n(6677),h=n(8939),f=n(1585);function initSyncButton(sync){const e=s.getElementById("sync-styles"),elMsg=s.querySelector("#backup p"),render=val=>{const drive=c.DRIVE_NAMES[val.drive||r.__values["sync.enabled"]],msg=drive?c.getStatusText(val):"";e.title=d.t("optionsCustomizeSync"),a.$toggleDataset(e,"cloud",drive),elMsg.textContent=msg===c.pending||msg===c.connected?"":msg};i.onMessage.set(e=>{"syncStatusUpdate"===e.method&&render(e.status)}),render(sync)}o.tBody(),(async()=>{const{badFavs,ids,styles,sync}=r.clientData;l.setupLivePrefs(),f.newUI.render(!0),r.subscribe(f.newUI.ids.map(f.newUI.prefKeyForId),()=>f.newUI.render()),h.init(),p.update(),f.newUI.hasFavs()&&u.readBadFavs(badFavs),u.showStyles(styles,ids),initSyncButton(sync),n.e("manage_lazy-init_js").then(n.bind(n,6560))})(),s.styleSheets[0].insertRule(`:root {${["genericDisabledLabel","updateAllCheckSucceededSomeEdited","filteredStylesAllHidden"].map(e=>`--${e}:"${CSS.escape(d.t(e))}";`).join("")}}`)},6677:(e,n,a)=>{n.makeToggle=function(toggler,hashId,showHide,loadDeps){const hash="#"+hashId,selector="."+hashId;watch({hash},async state=>{const e=s.querySelector(selector);!state!=!e&&(state&&loadDeps&&(showHide??=await loadDeps()),await showHide(state,e,selector,toggler),state&&updateHash(""))});for(const e of s.querySelectorAll(toggler))e.on("click",()=>{toggler=e,updateHash(hash)})},n.update=update,n.updateSearch=function(what,value){const e=new URL(location),entries="object"==typeof what?Object.entries(what):[[what,value]];for(const[key,val]of entries)val?e.searchParams.set(key,val):e.searchParams.delete(key);history.replaceState(history.state,null,`${e}`),buffer.pop(),update()},n.watch=watch;var l=a(3619),o=a(6940);const buffer=history.state?.buffer||[],watchers=[];function push(url){const state=history.state||{};state.buffer=buffer,history.pushState(state,null,url)}function update(){if(buffer.length){if(buffer[buffer.length-1]===location.href)return void(watchers.some(e=>!e.init)&&callWatchers());buffer.length>1&&buffer[buffer.length-2]===location.href?buffer.pop():buffer.push(location.href)}else buffer.push(location.href);callWatchers()}function callWatchers(){for(const e of watchers){const{options,callback}=e;let state;if(e.init=!0,options.hash)state=options.hash===location.hash;else if(options.search){const search=new URLSearchParams(location.search);state=options.search.map(key=>search.get(key))}o.deepEqual(state,options.currentState)||(options.currentState=state,callback(state))}}function updateHash(hash){buffer.length>1&&(!hash&&!buffer[buffer.length-2].includes("#")||hash&&buffer[buffer.length-2].endsWith(hash))?history.back():(hash||(hash=" "),push(hash),update())}function watch(options,callback){watchers.push({options,callback})}t.on("popstate",update),t.on("hashchange",update),l.onMessage.set(e=>{"pushState"===e.method&&e.url!==location.href&&(push(e.url),update())}),a.d(n,{})},8939:(e,a,l)=>{a.init=function(){i.subscribe(d,update),addOptions(),i.subscribe("manage.minColumnWidth",updateColumnWidth,!0)},a.sort=sort,a.update=update,a.updateStripes=updateStripes;var o=l(7986),i=l(492),r=l(6940),c=l(1585);const COL_MIN=300,COL_MAX=9999,COL_PROP="--columns",sorterType={alpha:(e,t)=>e<t?-1:e===t?0:1,number:(e,t)=>(e||0)-(t||0)},tagData={title:{text:r.t("genericTitle"),parse:e=>e.styleNameLC,sorter:sorterType.alpha},usercss:{text:"Usercss",parse:e=>e.styleMeta.usercssData?0:1,sorter:sorterType.number},disabled:{text:"",parse:e=>e.styleMeta.enabled?1:0,sorter:sorterType.number},dateInstalled:{text:r.t("dateInstalled"),parse:e=>e.styleMeta.installDate,sorter:sorterType.number},dateUpdated:{text:r.t("dateUpdated"),parse:({styleMeta:e})=>e.updateDate||e.installDate,sorter:sorterType.number},size:{text:r.t("genericSize"),parse:e=>e.styleSize,sorter:sorterType.number}},selectOptions=["{groupAsc}","title,asc","dateInstalled,desc, title,asc","dateInstalled,asc, title,asc","dateUpdated,desc, title,asc","dateUpdated,asc, title,asc","usercss,asc, title,asc","usercss,desc, title,asc","disabled,asc, title,asc","disabled,desc, title,asc","disabled,desc, usercss,asc, title,asc","size,desc, title,asc","{groupDesc}","title,desc","usercss,asc, title,desc","usercss,desc, title,desc","disabled,desc, title,desc","disabled,desc, usercss,asc, title,desc"],splitRegex=/\s*,\s*/,d="manage.newUI.sort",getPref=()=>i.__values[d]||i.defaults[d];let minWidth,columns=1;function addOptions(){let container;const select=s.getElementById(d),renderBin=s.createDocumentFragment(),option=s.createElement("option"),optgroup=s.createElement("optgroup"),meta={desc:" ðŸ ‡",enabled:r.t("genericEnabledLabel"),disabled:r.t("genericDisabledLabel"),dateNew:` (${r.t("sortDateNewestFirst")})`,dateOld:` (${r.t("sortDateOldestFirst")})`,groupAsc:r.t("sortLabelTitleAsc"),groupDesc:r.t("sortLabelTitleDesc")};selectOptions.forEach(opt=>{if(/{\w+}/.test(opt))return container&&renderBin.appendChild(container),container=optgroup.cloneNode(),void(container.label=meta[opt.substring(1,opt.length-1)]);let lastTag="";const elOpt=option.cloneNode();elOpt.textContent=opt.split(splitRegex).reduce((acc,val)=>tagData[val]?(lastTag=val,acc+(""!==acc?" + ":"")+tagData[val].text):lastTag.indexOf("date")>-1?acc+meta["desc"===val?"dateNew":"dateOld"]:"disabled"===lastTag?acc+meta["desc"===val?"enabled":"disabled"]:acc+(meta[val]||""),""),elOpt.value=opt,container.appendChild(elOpt)}),renderBin.appendChild(container),select.appendChild(renderBin),select.value=getPref()}function sort(styles){const sortBy=getPref().split(splitRegex),len=sortBy.length;return styles.sort((e,t)=>{let types,direction,result=0,index=0;for(;0===result&&index<len;)types=tagData[sortBy[index++]],direction="asc"===sortBy[index++]?1:-1,result=types.sorter(types.parse(e),types.parse(t))*direction;return result})}function update(){const current=[...c.installed.children],sorted=sort([...current]);current.some((e,t)=>e!==sorted[t])&&c.installed.append(...sorted),updateStripes()}function updateStripes({onlyWhenColumnsChanged}={}){if(onlyWhenColumnsChanged&&!updateColumnCount())return;let index=0,isOdd=!1;const flipRows=columns%2==0;for(const{classList}of c.installed.children)classList.contains("hidden")||(classList.toggle("odd",isOdd),classList.toggle("even",!isOdd),flipRows&&++index>=columns?index=0:isOdd=!isOdd)}function updateColumnCount(){const e=[].some.call(n.children,e=>"STYLE"===e.tagName&&e.textContent.includes(COL_PROP+":"))?Math.max(1,getComputedStyle(n).getPropertyValue(COL_PROP)|0):minWidth?onResize():columns;if(columns!==e)return columns=e,!0}function updateColumnWidth(e,val){minWidth=Math.max(val,COL_MIN),val<COL_MAX?t.on("resize",onResize):(t.off("resize",onResize),n.style.removeProperty(COL_PROP)),updateStripes({onlyWhenColumnsChanged:!0})}function onResize(evt){const e=Math.max(1,(t.innerWidth-o.dom.HWval)/minWidth|0);return columns!==e&&(n.style.setProperty(COL_PROP,e),evt&&(columns=e,updateStripes())),e}l.d(a,{columns:()=>columns})},9168:(e,l,o)=>{l.createStyleElement=createStyleElement,l.createTargetsElement=createTargetsElement,l.fitNameColumn=fitNameColumn,l.fitSizeColumn=fitSizeColumn,l.readBadFavs=readBadFavs,l.renderFavs=renderFavs,l.renderMissingFavs=function(num,iconsMissing,iconsEnabled){for(const entry of manage_util.installed.children)entry.$(".applies-to").classList.toggle("has-more",entry._numTargets>num),!entry._allTargetsRendered&&num>entry.$(".targets").childElementCount?(createTargetsElement({entry}),iconsMissing|=iconsEnabled):(+entry.style.getPropertyValue("--num-targets")||1e9)>num&&entry.style.setProperty("--num-targets",num);return iconsMissing},l.showStyles=function(styles=[],matchUrlIds){const dummies=styles.map(manage_util.styleToDummyEntry),sorted=sorter.sort(dummies);let index=0,firstRun=!0;const scrollY=history.state?.scrollY,shouldRenderAll=scrollY>t.innerHeight||util.sessionStore.justEditedStyleId||canRenderAll,renderBin=s.createDocumentFragment();favsBusy=manage_util.newUI.hasFavs(),fitNameColumn(styles),fitSizeColumn(dummies),function renderStyles(){const e=!shouldRenderAll&&performance.now();for(;index<sorted.length&&(shouldRenderAll||(7&index)<7||performance.now()-e<50);){const entry=createStyleElement(sorted[index++]);matchUrlIds&&!matchUrlIds.includes(entry.styleMeta.id)&&entry.classList.add("not-matching","hidden"),renderBin.appendChild(entry)}if(filters.filterAndAppend({container:renderBin},matchUrlIds).then(sorter.updateStripes),index<sorted.length)return requestAnimationFrame(renderStyles),firstRun&&favsBusy&&renderFavs(),void(firstRun=!1);favsBusy&&renderFavs().then(()=>favsBusy=!1),util.sessionStore.justEditedStyleId&&setTimeout(highlightEditedStyle)}(),updateTotal(styles.length)},l.updateTotal=updateTotal;var dom=o(7986),dom_util=o(3831),localization=o(7501),prefs=o(492),sections_util=o(2013),util=o(6940),filters=o(5393),sorter=o(8939),manage_util=o(1585),msg_api=o(4930),urls=o(8982),util_webext=o(1480);const BAD_FAVS_KEY="badFavs";let badFavs,dbBusy;async function renderFavs(container=manage_util.installed){if(!manage_util.newUI.hasFavs())return;badFavs||initBadFavs(),badFavs.then&&await badFavs;const regexpRemoveNegativeLookAhead=/(\?!([^)]+\))|\(\?![\w(]+[^)]+[\w|)]+)/g,regexpReplaceExtraCharacters=/[\\(]|((\|\w+)+\))/g,regexpMatchRegExp=/[\w-]+[.(]+(com|org|co|net|im|io|edu|gov|biz|info|de|cn|uk|nl|eu|ru)\b/g,regexpMatchDomain=/^.*?:\/\/\W*([-.\w]+)/;for(const target of container.$$(".target")){const type=target.dataset.type,targetValue=target.textContent;if(!targetValue)continue;let favicon="";if("domains"===type?favicon=targetValue:/-extension:\\?\//.test(targetValue)?favicon=util_webext.MF_ICON:"regexps"===type?(favicon=targetValue.replace(regexpRemoveNegativeLookAhead,"").replace(regexpReplaceExtraCharacters,"").match(regexpMatchRegExp),favicon=favicon?favicon.shift():""):/^(f|ht)tps?:/.test(targetValue)&&(favicon=targetValue.match(regexpMatchDomain),favicon=favicon?favicon[1].replace(/\W+$/,""):""),!favicon||badFavs.includes(favicon)){target.firstElementChild||target.prepend(dom.$create("b"));continue}favicon!==util_webext.MF_ICON&&(favicon=urls.favicon(favicon));const img=target.$(":scope > img:first-child")||target.insertAdjacentElement("afterbegin",dom.$create("img",{loading:"lazy"}));(img.dataset.src||img.src)!==favicon&&(img.src=favicon)}}async function readBadFavs(val){return val||(val=await(dbBusy||(dbBusy=msg_api.API.prefsDB.get(BAD_FAVS_KEY))),dbBusy=!1),manage_util.newUI.cfg[BAD_FAVS_KEY]=Array.isArray(val)?val:[]}async function initBadFavs(){const{put}=msg_api.API.prefsDB,rxHost=new RegExp(`^${util.stringAsRegExpStr(urls.favicon("\n")).replace("\n","(.*)")}$`);badFavs=manage_util.newUI.cfg[BAD_FAVS_KEY]||await(badFavs=readBadFavs());const e=e=>{const code=e.statusCode,host=code&&200!==code&&e.url.match(rxHost)[1];host&&!badFavs.includes(host)&&(badFavs.push(host),util.debounce(put,250,badFavs,BAD_FAVS_KEY))},filter={urls:[urls.favicon("*")],types:["image"],tabId:(await util_webext.getOwnTab()).id};chrome.webRequest.onCompleted.addListener(e,filter),chrome.webRequest.onErrorOccurred.addListener(e,filter)}const AGES=[[24,"h",util.t("dateAbbrHour","")],[30,"d",util.t("dateAbbrDay","")],[12,"m",util.t("dateAbbrMonth","")],[1/0,"y",util.t("dateAbbrYear","")]],canRenderAll=CSS.supports("content-visibility","auto"),groupThousands=num=>`${num}`.replace(/\d(?=(\d{3})+$)/g,"$&Â "),renderSize=size=>groupThousands(Math.round(size/1024))+"k",nameLengths=new Map,partEditHrefBase="edit.html?id=",partDecorations={urlPrefixesAfter:"*",regexpsBefore:"/",regexpsAfter:"/"},rxIsDateVer=/^20\d{4,6}(?:\.\d\d?){2}$/,rxNonCJK=/[^\u3000-\uFE00]+/g;let elLinks,elLinksParent,favsBusy,partEntry,partChecker,partEditLink,partEntryClassBase,partHomepage,partInfoAge,partInfoSize,partInfoVer,partNameLink,partNewUI,partOldCheckUpdate,partOldConfigure,partTargets,tplConfigureIcon,tplEverything,tplExtra,tplSep,tplTarget,tplUpdaterIcons,numStyles=0;function createAgeText(e,style){let val=style.updateDate||style.installDate;if(val){val=(Date.now()-val)/36e5;for(const[max,unit,text]of AGES){const rounded=Math.round(val);if(rounded<max){e.textContent=text.replace("",rounded),e.dataset.value=manage_util.padLeft(Math.round(rounded),2)+unit;break}val/=max}}else e.firstChild&&(e.textContent="",delete e.dataset.value)}function createParts(isNew){return partNewUI=isNew,partEntry=localization.template[isNew?"styleNewUI":"style"].cloneNode(!0),partEntryClassBase=partEntry.className,partChecker=partEntry.$("input")||{},partNameLink=partEntry.$(".style-name-link"),partEditLink=partEntry.$(".style-edit-link")||{},partHomepage=partEntry.$(".homepage"),partInfoAge=partEntry.$("[data-type=age]"),partInfoSize=partEntry.$("[data-type=size]"),partInfoVer=partEntry.$("[data-type=version]"),partTargets=partEntry.$(".targets"),partOldConfigure=!isNew&&partEntry.$(".configure-usercss"),partOldCheckUpdate=!isNew&&partEntry.$(".check-update"),partEntry}function createStyleElement({styleMeta:style,styleNameLC:nameLC,styleSize:size}){const e=style.usercssData,{updateUrl}=style,configurable=!!e?.vars,name=style.customName||style.name,version=e?e.version:"",isNew=manage_util.newUI.cfg.enabled;isNew!==partNewUI&&createParts(isNew),partChecker.checked=style.enabled,partNameLink.firstChild.textContent=localization.breakWord(name),partNameLink.href=partEditLink.href=partEditHrefBase+style.id,partHomepage.href=partHomepage.title=style.url||"",partInfoVer.textContent=version,partInfoVer.dataset.value=version,dom.$toggleDataset(partInfoVer,"isDate",version.length>=8&&rxIsDateVer.test(version)),createAgeText(partInfoAge,style),partInfoSize.dataset.value=Math.log10(size||1)|0,partInfoSize.textContent=renderSize(size),partInfoSize.title=`${util.t("genericSize")}: ${groupThousands(size)} B`,isNew||(partOldConfigure.classList.toggle("hidden",!configurable),partOldCheckUpdate.classList.toggle("hidden",!updateUrl));const entry=partEntry.cloneNode(!0);return entry.id="style-"+style.id,entry.styleId=style.id,entry.styleNameLC=nameLC,entry.styleMeta=style,entry.styleSize=size,entry.className=partEntryClassBase+" "+(style.enabled?"enabled":"disabled")+(updateUrl?" updatable":"")+(e?" usercss":""),isNew&&(updateUrl||configurable)&&entry.$(".actions").append(...[updateUrl&&(tplUpdaterIcons??=localization.template.updaterIcons).cloneNode(!0),configurable&&(tplConfigureIcon??=localization.template.configureIcon).cloneNode(!0)].filter(Boolean)),createTargetsElement({entry,style}),entry}function createTargetsElement({entry,expanded,style=entry.styleMeta}){const isNew=manage_util.newUI.cfg.enabled,maxTargets=expanded?1e3:isNew?manage_util.newUI.cfg.targets:10;if(!maxTargets)return void(entry._numTargets=0);const displayed=new Set,entryTargets=entry.$(".targets"),expanderCls=entry.$(".applies-to").classList,targets=partTargets.cloneNode(!0),toAppend=[];let container=targets,e=entryTargets.firstElementChild,numTargets=0,allTargetsRendered=!0;for(const type in sections_util.TO_CSS)for(const section of style.sections)for(const targetValue of section[type]||[]){if(displayed.has(targetValue))continue;if(++numTargets>maxTargets){allTargetsRendered=expanded;break}displayed.add(targetValue);const text=(partDecorations[type+"Before"]||"")+targetValue+(partDecorations[type+"After"]||"");if(e&&e.dataset.type===type&&e.lastChild.textContent===text){const next=e.nextElementSibling;toAppend.push(e),e=next;continue}const element=(tplTarget??=localization.template.appliesToTarget).cloneNode(!0);if(!isNew)if(numTargets===maxTargets){const extra=(tplExtra??=localization.template.extraAppliesTo).cloneNode(!0);toAppend.push(extra),container.append(...toAppend),container=extra,toAppend.length=0}else numTargets>1&&toAppend.push((tplSep??=localization.template.appliesToSeparator).cloneNode(!0));element.dataset.type=type,element.append(text),toAppend.push(element)}container.append(...toAppend),isNew&&numTargets>manage_util.newUI.cfg.targets&&expanderCls.add("has-more"),numTargets?entryTargets.parentElement.replaceChild(targets,entryTargets):entry.classList.contains("global")&&entryTargets.firstElementChild||(entryTargets.firstElementChild&&(entryTargets.textContent=""),entryTargets.appendChild((tplEverything??=localization.template.appliesToEverything).cloneNode(!0))),entry.classList.toggle("global",!numTargets),entry._allTargetsRendered=allTargetsRendered,entry._numTargets=numTargets,isNew&&entry.style.setProperty("--num-targets",Math.min(numTargets,manage_util.newUI.cfg.targets))}function highlightEditedStyle(){if(!util.sessionStore.justEditedStyleId)return;const entry=s.getElementById("style-"+util.sessionStore.justEditedStyleId);delete util.sessionStore.justEditedStyleId,entry&&(dom_util.animateElement(entry),requestAnimationFrame(()=>dom_util.scrollElementIntoView(entry)))}function fitNameColumn(styles,style){style&&calcNameLenKey(style),styles=styles?styles.map(calcNameLenKey):[...nameLengths.values()];const pick=sorter.columns>1?.8:.95,res=nameLengths.res=styles.sort()[nameLengths.size*pick|0]+5-1e9;n.style.setProperty("--name-width",res+"ch")}function calcNameLenKey(style){const name=style.displayName||style.name||"",len=1e9+(style.enabled?1.05:1)*(name.length+name.replace(rxNonCJK,"").length)|0;return nameLengths.set(style.id,len),len}function fitSizeColumn(entries=manage_util.installed.children,entry){let res=entry&&renderSize(entry.styleSize).length||0;if(res){if(res<=parseInt(n.style.getPropertyValue("--size-width")))return}else{for(const e of entries)res=Math.max(res,e.styleSize);res=renderSize(res).length}n.style.setProperty("--size-width",res+"ch")}function updateTotal(delta){if(numStyles+=delta,+manage_util.installed.dataset.total===numStyles)return;manage_util.installed.dataset.total=numStyles,elLinksParent??=(elLinks=s.getElementById("links")).parentNode;const det=elLinks.$("details"),prefId="manage.links.expanded";dom.$toggleDataset(det,"pref",numStyles&&prefId),det.open=!numStyles||prefs.__values[prefId],numStyles?elLinksParent.append(elLinks):manage_util.installed.after(elLinks),a.toggle("empty",!numStyles)}o.d(l,{favsBusy:()=>favsBusy,partEntry:()=>partEntry})}},e=>{e.O(0,["common-ui","css_global-dark_css-css_global_css-css_spinner_css"],()=>e(e.s=6598));e.O()}])}