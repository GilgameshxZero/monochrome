@ECHO OFF
@REM Automatically turns on the hotspot on Windows.
CALL powershell.exe -encodedCommand WwBXAGkAbgBkAG8AdwBzAC4AUwB5AHMAdABlAG0ALgBVAHMAZQByAFAAcgBvAGYAaQBsAGUALgBMAG8AYwBrAFMAYwByAGUAZQBuACwAVwBpAG4AZABvAHcAcwAuAFMAeQBzAHQAZQBtAC4AVQBzAGUAcgBQAHIAbwBmAGkAbABlACwAQwBvAG4AdABlAG4AdABUAHkAcABlAD0AVwBpAG4AZABvAHcAcwBSAHUAbgB0AGkAbQBlAF0AIAB8ACAATwB1AHQALQBOAHUAbABsAAoAQQBkAGQALQBUAHkAcABlACAALQBBAHMAcwBlAG0AYgBsAHkATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AUgB1AG4AdABpAG0AZQAuAFcAaQBuAGQAbwB3AHMAUgB1AG4AdABpAG0AZQAKACQAYQBzAFQAYQBzAGsARwBlAG4AZQByAGkAYwAgAD0AIAAoAFsAUwB5AHMAdABlAG0ALgBXAGkAbgBkAG8AdwBzAFIAdQBuAHQAaQBtAGUAUwB5AHMAdABlAG0ARQB4AHQAZQBuAHMAaQBvAG4AcwBdAC4ARwBlAHQATQBlAHQAaABvAGQAcwAoACkAIAB8ACAAPwAgAHsAIAAkAF8ALgBOAGEAbQBlACAALQBlAHEAIAAnAEEAcwBUAGEAcwBrACcAIAAtAGEAbgBkACAAJABfAC4ARwBlAHQAUABhAHIAYQBtAGUAdABlAHIAcwAoACkALgBDAG8AdQBuAHQAIAAtAGUAcQAgADEAIAAtAGEAbgBkACAAJABfAC4ARwBlAHQAUABhAHIAYQBtAGUAdABlAHIAcwAoACkAWwAwAF0ALgBQAGEAcgBhAG0AZQB0AGUAcgBUAHkAcABlAC4ATgBhAG0AZQAgAC0AZQBxACAAJwBJAEEAcwB5AG4AYwBPAHAAZQByAGEAdABpAG8AbgBgADEAJwAgAH0AKQBbADAAXQAKAEYAdQBuAGMAdABpAG8AbgAgAEEAdwBhAGkAdAAoACQAVwBpAG4AUgB0AFQAYQBzAGsALAAgACQAUgBlAHMAdQBsAHQAVAB5AHAAZQApACAAewAKACAAIAAgACAAJABhAHMAVABhAHMAawAgAD0AIAAkAGEAcwBUAGEAcwBrAEcAZQBuAGUAcgBpAGMALgBNAGEAawBlAEcAZQBuAGUAcgBpAGMATQBlAHQAaABvAGQAKAAkAFIAZQBzAHUAbAB0AFQAeQBwAGUAKQAKACAAIAAgACAAJABuAGUAdABUAGEAcwBrACAAPQAgACQAYQBzAFQAYQBzAGsALgBJAG4AdgBvAGsAZQAoACQAbgB1AGwAbAAsACAAQAAoACQAVwBpAG4AUgB0AFQAYQBzAGsAKQApAAoAIAAgACAAIAAkAG4AZQB0AFQAYQBzAGsALgBXAGEAaQB0ACgALQAxACkAIAB8ACAATwB1AHQALQBOAHUAbABsAAoAIAAgACAAIAAkAG4AZQB0AFQAYQBzAGsALgBSAGUAcwB1AGwAdAAKAH0ACgBGAHUAbgBjAHQAaQBvAG4AIABBAHcAYQBpAHQAQQBjAHQAaQBvAG4AKAAkAFcAaQBuAFIAdABBAGMAdABpAG8AbgApACAAewAKACAAIAAgACAAJABhAHMAVABhAHMAawAgAD0AIAAoAFsAUwB5AHMAdABlAG0ALgBXAGkAbgBkAG8AdwBzAFIAdQBuAHQAaQBtAGUAUwB5AHMAdABlAG0ARQB4AHQAZQBuAHMAaQBvAG4AcwBdAC4ARwBlAHQATQBlAHQAaABvAGQAcwAoACkAIAB8ACAAPwAgAHsAIAAkAF8ALgBOAGEAbQBlACAALQBlAHEAIAAnAEEAcwBUAGEAcwBrACcAIAAtAGEAbgBkACAAJABfAC4ARwBlAHQAUABhAHIAYQBtAGUAdABlAHIAcwAoACkALgBDAG8AdQBuAHQAIAAtAGUAcQAgADEAIAAtAGEAbgBkACAAIQAkAF8ALgBJAHMARwBlAG4AZQByAGkAYwBNAGUAdABoAG8AZAAgAH0AKQBbADAAXQAKACAAIAAgACAAJABuAGUAdABUAGEAcwBrACAAPQAgACQAYQBzAFQAYQBzAGsALgBJAG4AdgBvAGsAZQAoACQAbgB1AGwAbAAsACAAQAAoACQAVwBpAG4AUgB0AEEAYwB0AGkAbwBuACkAKQAKACAAIAAgACAAJABuAGUAdABUAGEAcwBrAC4AVwBhAGkAdAAoAC0AMQApACAAfAAgAE8AdQB0AC0ATgB1AGwAbAAKAH0ACgAKACQAYwBvAG4AbgBlAGMAdABpAG8AbgBQAHIAbwBmAGkAbABlACAAPQAgAFsAVwBpAG4AZABvAHcAcwAuAE4AZQB0AHcAbwByAGsAaQBuAGcALgBDAG8AbgBuAGUAYwB0AGkAdgBpAHQAeQAuAE4AZQB0AHcAbwByAGsASQBuAGYAbwByAG0AYQB0AGkAbwBuACwAVwBpAG4AZABvAHcAcwAuAE4AZQB0AHcAbwByAGsAaQBuAGcALgBDAG8AbgBuAGUAYwB0AGkAdgBpAHQAeQAsAEMAbwBuAHQAZQBuAHQAVAB5AHAAZQA9AFcAaQBuAGQAbwB3AHMAUgB1AG4AdABpAG0AZQBdADoAOgBHAGUAdABJAG4AdABlAHIAbgBlAHQAQwBvAG4AbgBlAGMAdABpAG8AbgBQAHIAbwBmAGkAbABlACgAKQAKACQAdABlAHQAaABlAHIAaQBuAGcATQBhAG4AYQBnAGUAcgAgAD0AIABbAFcAaQBuAGQAbwB3AHMALgBOAGUAdAB3AG8AcgBrAGkAbgBnAC4ATgBlAHQAdwBvAHIAawBPAHAAZQByAGEAdABvAHIAcwAuAE4AZQB0AHcAbwByAGsATwBwAGUAcgBhAHQAbwByAFQAZQB0AGgAZQByAGkAbgBnAE0AYQBuAGEAZwBlAHIALABXAGkAbgBkAG8AdwBzAC4ATgBlAHQAdwBvAHIAawBpAG4AZwAuAE4AZQB0AHcAbwByAGsATwBwAGUAcgBhAHQAbwByAHMALABDAG8AbgB0AGUAbgB0AFQAeQBwAGUAPQBXAGkAbgBkAG8AdwBzAFIAdQBuAHQAaQBtAGUAXQA6ADoAQwByAGUAYQB0AGUARgByAG8AbQBDAG8AbgBuAGUAYwB0AGkAbwBuAFAAcgBvAGYAaQBsAGUAKAAkAGMAbwBuAG4AZQBjAHQAaQBvAG4AUAByAG8AZgBpAGwAZQApAAoACgAjACAASQBmACAATQBvAGIAaQBsAGUAIABIAG8AdABzAHAAbwB0ACAAaQBzACAAbwBmAGYAIAAtACAAdAB1AHIAbgAgAGkAdAAgAG8AbgAuAAoAaQBmACAAKAAkAHQAZQB0AGgAZQByAGkAbgBnAE0AYQBuAGEAZwBlAHIALgBUAGUAdABoAGUAcgBpAG4AZwBPAHAAZQByAGEAdABpAG8AbgBhAGwAUwB0AGEAdABlACAALQBuAGUAIAAxACkAewAKACAAIAAgACAAZQBjAGgAbwAgACIAWwAkACgARwBlAHQALQBEAGEAdABlACkAXQAgAFIAZQBzAHQAYQByAHQAaQBuAGcALgAuAC4AIgAKACAAIAAgACAAIwAgAFMAdABhAHIAdAAgAE0AbwBiAGkAbABlACAASABvAHQAcwBwAG8AdAAKACAAIAAgACAAQQB3AGEAaQB0ACAAKAAkAHQAZQB0AGgAZQByAGkAbgBnAE0AYQBuAGEAZwBlAHIALgBTAHQAYQByAHQAVABlAHQAaABlAHIAaQBuAGcAQQBzAHkAbgBjACgAKQApACAAKABbAFcAaQBuAGQAbwB3AHMALgBOAGUAdAB3AG8AcgBrAGkAbgBnAC4ATgBlAHQAdwBvAHIAawBPAHAAZQByAGEAdABvAHIAcwAuAE4AZQB0AHcAbwByAGsATwBwAGUAcgBhAHQAbwByAFQAZQB0AGgAZQByAGkAbgBnAE8AcABlAHIAYQB0AGkAbwBuAFIAZQBzAHUAbAB0AF0AKQAgAHwAIABPAHUAdAAtAE4AdQBsAGwACgB9AAoA

@REM [Windows.System.UserProfile.LockScreen,Windows.System.UserProfile,ContentType=WindowsRuntime] | Out-Null
@REM Add-Type -AssemblyName System.Runtime.WindowsRuntime
@REM $asTaskGeneric = ([System.WindowsRuntimeSystemExtensions].GetMethods() | ? { $_.Name -eq 'AsTask' -and $_.GetParameters().Count -eq 1 -and $_.GetParameters()[0].ParameterType.Name -eq 'IAsyncOperation`1' })[0]
@REM Function Await($WinRtTask, $ResultType) {
@REM     $asTask = $asTaskGeneric.MakeGenericMethod($ResultType)
@REM     $netTask = $asTask.Invoke($null, @($WinRtTask))
@REM     $netTask.Wait(-1) | Out-Null
@REM     $netTask.Result
@REM }
@REM Function AwaitAction($WinRtAction) {
@REM     $asTask = ([System.WindowsRuntimeSystemExtensions].GetMethods() | ? { $_.Name -eq 'AsTask' -and $_.GetParameters().Count -eq 1 -and !$_.IsGenericMethod })[0]
@REM     $netTask = $asTask.Invoke($null, @($WinRtAction))
@REM     $netTask.Wait(-1) | Out-Null
@REM }

@REM $connectionProfile = [Windows.Networking.Connectivity.NetworkInformation,Windows.Networking.Connectivity,ContentType=WindowsRuntime]::GetInternetConnectionProfile()
@REM $tetheringManager = [Windows.Networking.NetworkOperators.NetworkOperatorTetheringManager,Windows.Networking.NetworkOperators,ContentType=WindowsRuntime]::CreateFromConnectionProfile($connectionProfile)

@REM # If Mobile Hotspot is off - turn it on.
@REM if ($tetheringManager.TetheringOperationalState -ne 1){
@REM     echo "[$(Get-Date)] Restarting..."
@REM     # Start Mobile Hotspot
@REM     Await ($tetheringManager.StartTetheringAsync()) ([Windows.Networking.NetworkOperators.NetworkOperatorTetheringOperationResult]) | Out-Null
@REM }
